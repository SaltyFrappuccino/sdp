// Утилита для работы с подсказками из справочника и навигацией по разделам

// Якоря разделов в справочнике для быстрой навигации
export const HANDBOOK_SECTIONS = {
  // Основные разделы
  worldLore: 'глава-1-разлом-и-новый-мир',
  geography: 'глава-2-география-и-политика',
  factions: 'глава-3-фракции',
  economy: 'глава-4-экономика',
  
  // Ключевые понятия
  creatures: 'глава-5-существа',
  conductors: 'глава-6-проводники',
  contracts: 'глава-7-контракты-и-синхронизация',
  
  // Создание персонажа
  attributes: 'глава-8-система-атрибутов',
  archetypes: 'глава-9-архетипы',
  
  // Боевая система
  auraCells: 'глава-11-аура-и-её-ресурсы',
  abilityConstructor: 'глава-12-конструктор-способностей',
  combatRules: 'глава-13-тактические-правила-боя',
  manifestation: 'глава-14-эволюция-силы-манифестация-и-доминион',
  artifacts: 'глава-15-артефакты-синки',
  
  // Острова
  kaga: 'кага',
  hoshi: 'хоши',
  ichi: 'ичи',
  kuro: 'куро',
  midzu: 'мидзу',
  sora: 'сора',
} as const;

// Подсказки для различных полей анкеты
export const HANDBOOK_TOOLTIPS = {
  // Общие поля
  characterName: {
    text: 'Имя и фамилия вашего персонажа. Может отражать его происхождение с одного из островов.',
    section: HANDBOOK_SECTIONS.geography,
  },
  rank: {
    text: 'Ранг Проводника (F-SSS) определяет общую мощь, количество контрактов и запас Ячеек Ауры. Новые персонажи начинают с рангов F-B.',
    section: HANDBOOK_SECTIONS.conductors,
  },
  faction: {
    text: 'Фракция определяет идеологию и социальное положение персонажа. Основные: Порядок (закон), Отражённый Свет Солнца (религия), Чёрная Лилия (криминал) или Нейтрал.',
    section: HANDBOOK_SECTIONS.factions,
  },
  homeIsland: {
    text: 'Родной остров влияет на культуру, мировоззрение и связи персонажа. Кага - технологии, Хоши - духовность, Ичи - торговля, Куро - криминал, Мидзу - природа, Сора - дипломатия.',
    section: HANDBOOK_SECTIONS.geography,
  },
  
  // Атрибуты
  attributes: {
    text: 'Атрибуты определяют физические и ментальные возможности персонажа БЕЗ использования Ауры. Распределяйте очки по уровням: Дилетант (1), Новичок (2), Опытный (4), Эксперт (7), Мастер (10).',
    section: HANDBOOK_SECTIONS.attributes,
  },
  strength: {
    text: 'Физическая мощь. Мастер может оторвать от земли легкий мотоцикл или вырвать стальную арматуру из стены.',
    section: HANDBOOK_SECTIONS.attributes,
  },
  reaction: {
    text: 'Скорость рефлексов и ответа на угрозу. Мастер может инстинктивно увернуться от выстрела в упор (не от пули, а от движения оружия).',
    section: HANDBOOK_SECTIONS.attributes,
  },
  agility: {
    text: 'Акробатика, паркур и координация. Мастер способен пробежать по стене несколько шагов или спрыгнуть с третьего этажа на ноги.',
    section: HANDBOOK_SECTIONS.attributes,
  },
  endurance: {
    text: 'Стойкость и выносливость. Мастер может продолжать действовать с тяжелыми ранениями и имеет почти иммунитет к обычным ядам.',
    section: HANDBOOK_SECTIONS.attributes,
  },
  accuracy: {
    text: 'Меткость с дальнобойным оружием. Мастер способен попасть в монету в воздухе или поразить несколько целей одной очередью.',
    section: HANDBOOK_SECTIONS.attributes,
  },
  
  // Архетипы
  archetypes: {
    text: 'Архетипы определяют боевую роль персонажа в команде. Они не ограничивают способности, но показывают специализацию. Один персонаж может иметь несколько архетипов.',
    section: HANDBOOK_SECTIONS.archetypes,
  },
  
  // Контракты
  contractName: {
    text: 'Название контракта - это имя союза между Проводником и Существом. Может отражать тему или философию контракта.',
    section: HANDBOOK_SECTIONS.contracts,
  },
  creatureName: {
    text: 'Имя Существа - сущности из параллельного измерения. Может быть основано на мифологии, исторической личности или абстрактной концепции.',
    section: HANDBOOK_SECTIONS.creatures,
  },
  creatureRank: {
    text: 'Врожденный и неизменный ранг Существа (F-SSS), определяющий его потенциал. Игроки могут регистрировать Существ до ранга A включительно.',
    section: HANDBOOK_SECTIONS.creatures,
  },
  creatureSpectrum: {
    text: 'Спектр/тематика строго ограничивает Существо. Например, дух огня не может управлять водой, а воплощение радости не создаст атаки на основе страха. ЭТО КРИТИЧЕСКИ ВАЖНО для баланса!',
    section: HANDBOOK_SECTIONS.creatures,
  },
  gift: {
    text: 'Дар - постоянный пассивный эффект от Контракта. Не требует Ауры. Пример: "Вас сложнее заметить в полумраке" или "Ваша кожа немного плотнее обычной".',
    section: HANDBOOK_SECTIONS.contracts,
  },
  syncLevel: {
    text: 'Уровень Синхронизации (0-100%) отражает глубину понимания силы. Растет через отыгрыш и квесты. Каждые 10%/25% дают бонусные Ячейки Ауры.',
    section: HANDBOOK_SECTIONS.contracts,
  },
  unityStages: {
    text: 'Ступени Единения открываются по мере роста синхронизации: Активация (0%), Воплощение (25%), Манифестация (75%), Доминион (100%).',
    section: HANDBOOK_SECTIONS.manifestation,
  },
  
  // Способности
  abilities: {
    text: 'Способности создаются через "Бюджет Мощи" из Тегов. Каждый Тег имеет ранг и стоимость. Бюджет зависит от типа Ячейки и её количества.',
    section: HANDBOOK_SECTIONS.abilityConstructor,
  },
  cellTypes: {
    text: 'Типы Ячеек: Нулевая (атмосферные эффекты, бесплатны), Малая I (тактические приемы), Значительная II (мощные техники), Предельная III (ультимейты).',
    section: HANDBOOK_SECTIONS.auraCells,
  },
  activationConditions: {
    text: 'Условия активации делают силу более реалистичной. Вербальная - произнесение слов/фразы, Жест - движение телом, Общее - любое другое условие (например, "только ночью"). Все опциональны!',
    section: HANDBOOK_SECTIONS.abilityConstructor,
  },
  
  // Теги
  tagPiercing: {
    text: '[Пробивающий] - разрушительная мощь. F: пробивает стекло, E: ломает дерево, D: гнет сталь, C: пробивает стену, B: разрушает бетон, A: пробивает сейф, S: обрушает небоскреб.',
    section: HANDBOOK_SECTIONS.abilityConstructor,
  },
  tagUnavoidable: {
    text: '[Неотвратимый] - скорость. F: брошенный камень, E: стрела, D: пуля пистолета, C: винтовка, B: околозвуковая, A: звуковая, S: сверхзвуковая (5 Махов).',
    section: HANDBOOK_SECTIONS.abilityConstructor,
  },
  tagArea: {
    text: '[Область] - радиус действия. F: комната 3x3м, E: 10x10м, D: зал/улица, C: площадь, B: футбольное поле, A: квартал, S: район города.',
    section: HANDBOOK_SECTIONS.abilityConstructor,
  },
  tagControl: {
    text: '[Контроль] - ограничение противника. F: головокружение, E: дезориентация, D: ослепление, C: страх/простые иллюзии, B: паралич конечности, A: полный паралич.',
    section: HANDBOOK_SECTIONS.abilityConstructor,
  },
  tagDefensive: {
    text: '[Защитный] - прочность защиты. F: блокирует нож, E: пули пистолета, D: очередь ПП, C: штурмовая винтовка, B: граната/крупный калибр, A: танковое орудие.',
    section: HANDBOOK_SECTIONS.abilityConstructor,
  },
  tagConceptual: {
    text: '[Концептуальный] - "нечестные" эффекты. D: урон только живой плоти, C: видеть сквозь стены, B: игнор брони, A: раны не лечатся магией, S: атака всегда попадает.',
    section: HANDBOOK_SECTIONS.abilityConstructor,
  },
  
  // Синки (артефакты)
  shinki: {
    text: 'Синки - магические предметы. Осколок (пассивный эффект), Фокус (усиление способностей Контракта), Эхо (собственные способности и Ячейки).',
    section: HANDBOOK_SECTIONS.artifacts,
  },
  shinkiShard: {
    text: 'Осколок - самый распространенный тип. Дает один постоянный пассивный эффект без затрат Ауры. Пример: кольца для телепатии, компас указывающий на врагов.',
    section: HANDBOOK_SECTIONS.artifacts,
  },
  shinkiFocus: {
    text: 'Фокус - персональный артефакт, усиливающий существующие способности Проводника. Дарован Существом или создан Ремесленником. Не дает новых способностей!',
    section: HANDBOOK_SECTIONS.artifacts,
  },
  shinkiEcho: {
    text: 'Эхо - наследие умершего Проводника или созданный артефакт. Имеет собственные Ячейки Ауры и способности. Можно использовать его энергию вместо своей.',
    section: HANDBOOK_SECTIONS.artifacts,
  },
  
  // Манифестация
  manifestation: {
    text: 'Манифестация (75% синхронизации) - материализация силы Контракта. Необходима для использования Предельных техник. Выберите модус: Аватар, Проекция, Вооружение или Слияние.',
    section: HANDBOOK_SECTIONS.manifestation,
  },
  
  // Доминион
  dominion: {
    text: 'Доминион (100% синхронизации) - создание подпространства с собственными законами. Высшая демонстрация силы Проводника. Стоит 1 Предельную Ячейку за активацию и поддержание.',
    section: HANDBOOK_SECTIONS.manifestation,
  },
} as const;

// Функция для навигации к разделу справочника
export const navigateToHandbookSection = (sectionId: string) => {
  // Проверяем, находимся ли мы в VK Mini App
  if (typeof window !== 'undefined') {
    // Получаем текущий путь
    const currentHash = window.location.hash;
    
    // Если мы уже на странице справочника, просто скроллим
    if (currentHash.includes('handbook')) {
      setTimeout(() => {
        const element = document.getElementById(sectionId);
        if (element) {
          element.scrollIntoView({ behavior: 'smooth', block: 'start' });
          // Сохраняем позицию для восстановления
          localStorage.setItem('handbook_scroll_position', sectionId);
        }
      }, 100);
    } else {
      // Сохраняем целевую секцию для автоматического перехода после загрузки
      localStorage.setItem('handbook_target_section', sectionId);
      // Переходим на страницу справочника
      window.location.hash = '#/handbook';
    }
  }
};

// Вспомогательная функция для получения подсказки по ключу
export const getTooltip = (key: keyof typeof HANDBOOK_TOOLTIPS) => {
  return HANDBOOK_TOOLTIPS[key];
};

